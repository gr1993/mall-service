<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout/layout :: layout(~{::title},~{::main})}"
      lang="ko"
>
<head>
    <title>관리자 - 상품 관리</title>
</head>
<body>
<main>
    <div class="container-fluid px-4">
        <h1 class="mt-4">상품 관리</h1>
        <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item">상품</li>
            <li class="breadcrumb-item">상품 관리</li>
            <li class="breadcrumb-item active">등록</li>
        </ol>

        <div class="card mb-4">
            <div class="card-body">
                <form id="searchForm">
                    <input class="form-control d-none" type="file" id="inputFile" onchange="fileChange(this);">
                    <div class="mb-3 row">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-2">
                            <img id="mainImgTag" class="d-none" src="" alt="상품 대표 이미지" height="200" width="200" />
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="mainImg" class="col-sm-2 col-form-label">상품 이미지 <span class="text-danger">*</span></label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="mainImg" name="mainImg">
                        </div>
                        <div class="col-sm-1">
                            <button type="button" class="btn btn-light" onclick="fileSelect('main');">파일 선택</button>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="productName" class="col-sm-2 col-form-label">상품명 <span class="text-danger">*</span></label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="productName" name="productName">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="price" class="col-sm-2 col-form-label">가격 <span class="text-danger">*</span></label>
                        <div class="col-sm-2">
                            <input type="number" class="form-control" id="price" name="price">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="descImg" class="col-sm-2 col-form-label">상세 이미지</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="descImg" name="descImg">
                        </div>
                        <div class="col-sm-1">
                            <button type="button" class="btn btn-light" onclick="fileSelect('desc');">파일 선택</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-2">
                            <button class="btn btn-primary btn-lg w-100" id="btnNavbarSearch" type="button">
                                등록
                            </button>
                        </div>
                        <div class="col-sm-2">
                            <button class="btn btn-secondary btn-lg w-100" type="button">
                                뒤로
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        var fileType = '';

        // 파일 선택창 띄우기
        function fileSelect(type) {
            fileType = type;
            document.getElementById("inputFile").click();
        }

        // 파일 선택 시 임시 업로드
        function fileChange(inputFile) {
            const file = inputFile.files[0];

            if (!file) {
                alert("파일을 선택해주세요.");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            fetchPost({
                url : '/admin/file/temp/upload',
                data : formData,
                success : async function(response) {
                    const res = await response.json();

                    // 상품 이미지는 미리보기 표시
                    if (fileType === 'main') {
                        $('#mainImgTag').attr("src", '/admin/file/download?filePath=' + res.fileTempDir + '/' + res.fileName);
                        $('#mainImgTag').removeClass('d-none');
                    }

                    $('#' + fileType + 'Img').val(res.fileName);
                    alert("임시 업로드에 성공하였습니다.");
                },
                fail : function(response) {
                    alert("임시 업로드 실패하였습니다.");
                }
            });
        }

        // 상품 등록하기
        function register() {
            if (confirm('[[#{product.register.before}]]')) {

            }
        }

    </script>
</main>
</body>
</html>
